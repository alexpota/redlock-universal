<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>redlock-universal</title><meta name="description" content="Documentation for redlock-universal"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">redlock-universal</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>redlock-universal</h2></div><div class="tsd-panel tsd-typography"><a id="md:redlock-universal" class="tsd-anchor"></a><h1><a href="#md:redlock-universal">redlock-universal</a></h1><blockquote>
<p>Production-ready distributed Redis locks for Node.js with support for both
node-redis and ioredis</p>
</blockquote>
<p><a href="https://www.npmjs.com/package/redlock-universal"><img src="https://img.shields.io/npm/v/redlock-universal.svg" alt="npm version"></a>
<a href="https://nodejs.org/"><img src="https://img.shields.io/node/v/redlock-universal.svg" alt="Node.js"></a>
<a href="https://www.typescriptlang.org/"><img src="https://img.shields.io/badge/TypeScript-5.0+-blue.svg" alt="TypeScript"></a>
<a href="#md:testing"><img src="https://img.shields.io/badge/coverage-85%25-green.svg" alt="Test Coverage"></a>
<a href="./LICENSE"><img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License: MIT"></a>
<a href="https://www.npmjs.com/package/redlock-universal"><img src="https://img.shields.io/npm/dm/redlock-universal.svg" alt="Downloads"></a></p>
<a id="md:overview" class="tsd-anchor"></a><h2><a href="#md:overview">Overview</a></h2><p>redlock-universal implements distributed Redis locks using the
<a href="http://redis.io/topics/distlock">Redlock algorithm</a>. It supports both
node-redis and ioredis clients through a unified TypeScript API with automatic
lock extension capabilities.</p>
<a id="md:features" class="tsd-anchor"></a><h2><a href="#md:features">Features</a></h2><ul>
<li>üîí <strong>Distributed Locks</strong>: True Redlock algorithm for multi-instance Redis</li>
<li>üîå <strong>Client Universal</strong>: Works with both <code>node-redis</code> v4+ and <code>ioredis</code> v5+</li>
<li>ü§ñ <strong>Auto-Extension</strong>: <code>using()</code> API with automatic lock extension for
long-running operations</li>
<li>üìã <strong>Structured Logging</strong>: Comprehensive Logger integration for production
observability</li>
<li>üè¢ <strong>Production Ready</strong>: Circuit breakers, health checks, error handling, and
retries</li>
<li>üöÄ <strong>TypeScript First</strong>: Full type safety and modern ESM support</li>
<li>‚ö° <strong>Performance</strong>: Sub-millisecond lock acquisition, competitive with leading
libraries</li>
<li>üìä <strong>Enhanced Monitoring</strong>: Built-in metrics, health checks, and structured
logging</li>
<li>üß™ <strong>Tested</strong>: 85%+ test coverage with unit and integration tests</li>
</ul>
<a id="md:table-of-contents" class="tsd-anchor"></a><h2><a href="#md:table-of-contents">Table of Contents</a></h2><ul>
<li><a href="#md:quick-start">Quick Start</a></li>
<li><a href="#md:core-concepts">Core Concepts</a></li>
<li><a href="#md:api-reference">API Reference</a></li>
<li><a href="#md:auto-extension-with-using-api">Auto-Extension</a></li>
<li><a href="#md:examples">Examples</a></li>
<li><a href="#md:migration-guide">Migration Guide</a></li>
<li><a href="#md:faq">FAQ</a></li>
<li><a href="#md:troubleshooting">Troubleshooting</a></li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2><a href="#md:installation">Installation</a></h2><pre><code class="language-bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">redlock-universal</span>
</code><button>Copy</button></pre>
<p><strong>Peer Dependencies</strong>: Install your preferred Redis client</p>
<pre><code class="language-bash"><span class="hl-3"># For node-redis users</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">redis</span><br/><br/><span class="hl-3"># For ioredis users</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">ioredis</span><br/><br/><span class="hl-3"># Or both if you need mixed environments</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">redis</span><span class="hl-1"> </span><span class="hl-2">ioredis</span>
</code><button>Copy</button></pre>
<a id="md:quick-start" class="tsd-anchor"></a><h2><a href="#md:quick-start">Quick Start</a></h2><a id="md:automatic-lock-management---the-easy-way" class="tsd-anchor"></a><h3><a href="#md:automatic-lock-management---the-easy-way">Automatic Lock Management - The Easy Way</a></h3><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">createLock</span><span class="hl-1">, </span><span class="hl-5">NodeRedisAdapter</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">createClient</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redis&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Setup Redis client</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-0">createClient</span><span class="hl-1">({ </span><span class="hl-5">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;redis://localhost:6379&#39;</span><span class="hl-1"> });</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Create lock</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;my-resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">, </span><span class="hl-3">// 30 seconds</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Automatic lock management - the easy way</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">using</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-5">signal</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">processData</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">// Lock auto-extends if needed, releases automatically</span><br/><span class="hl-1">  </span><span class="hl-3">// Check signal.aborted if you need to know about extension failures</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:traditional-approach-fine-control" class="tsd-anchor"></a><h3><a href="#md:traditional-approach-fine-control">Traditional Approach (Fine Control)</a></h3><pre><code class="language-typescript"><span class="hl-3">// Traditional approach (if you need fine control)</span><br/><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-3">// Critical section - only one process can be here</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">doSomeCriticalWork</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-4">catch</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Lock operation failed:&#39;</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:distributed-lock-multiple-redis-instances" class="tsd-anchor"></a><h3><a href="#md:distributed-lock-multiple-redis-instances">Distributed Lock (Multiple Redis Instances)</a></h3><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">createRedlock</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">NodeRedisAdapter</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">IoredisAdapter</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">createClient</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redis&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-5">Redis</span><span class="hl-1"> </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ioredis&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Setup multiple Redis connections</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">clients</span><span class="hl-1"> = [</span><br/><span class="hl-1">  </span><span class="hl-0">createClient</span><span class="hl-1">({ </span><span class="hl-5">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;redis://redis1:6379&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  </span><span class="hl-0">createClient</span><span class="hl-1">({ </span><span class="hl-5">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;redis://redis2:6379&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  </span><span class="hl-0">createClient</span><span class="hl-1">({ </span><span class="hl-5">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;redis://redis3:6379&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-3">// Connect all node-redis clients</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-9">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><span class="hl-5">clients</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">()));</span><br/><br/><span class="hl-3">// Create adapters (ioredis connects automatically)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adapters</span><span class="hl-1"> = [</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">clients</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">clients</span><span class="hl-1">[</span><span class="hl-8">1</span><span class="hl-1">]),</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">IoredisAdapter</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Redis</span><span class="hl-1">(</span><span class="hl-2">&#39;redis://redis3:6379&#39;</span><span class="hl-1">)),</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-3">// Create distributed lock</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlock</span><span class="hl-1"> = </span><span class="hl-0">createRedlock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapters</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;distributed-resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">quorum:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-3">// Majority consensus</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Use distributed lock</span><br/><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-3">// Critical section with distributed guarantee</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">processPayment</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-4">catch</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Distributed lock failed:&#39;</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-4">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// Disconnect all clients</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-9">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><span class="hl-5">clients</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1">.</span><span class="hl-0">disconnect</span><span class="hl-1">()));</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:core-concepts" class="tsd-anchor"></a><h2><a href="#md:core-concepts">Core Concepts</a></h2><a id="md:configuration-constants" class="tsd-anchor"></a><h3><a href="#md:configuration-constants">Configuration Constants</a></h3><ul>
<li><code>AUTO_EXTENSION_THRESHOLD_RATIO</code>: 0.2 - Extension triggers at 80% TTL consumed</li>
<li><code>ATOMIC_EXTENSION_SAFETY_BUFFER</code>: 2000ms - Minimum TTL for safe extension</li>
<li><code>MIN_EXTENSION_INTERVAL</code>: 100ms - Prevents rapid retry loops</li>
</ul>
<a id="md:api-reference" class="tsd-anchor"></a><h2><a href="#md:api-reference">API Reference</a></h2><a id="md:simple-lock" class="tsd-anchor"></a><h3><a href="#md:simple-lock">Simple Lock</a></h3><a id="md:createlockconfig" class="tsd-anchor"></a><h4><a href="#md:createlockconfig"><code>createLock(config)</code></a></h4><p>Creates a simple lock for single Redis instance.</p>
<pre><code class="language-typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-9">CreateLockConfig</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">adapter</span><span class="hl-1">: </span><span class="hl-9">RedisAdapter</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">key</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">ttl</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 30000ms</span><br/><span class="hl-1">  </span><span class="hl-5">retryAttempts</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 3</span><br/><span class="hl-1">  </span><span class="hl-5">retryDelay</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 100ms</span><br/><span class="hl-1">  </span><span class="hl-5">performance</span><span class="hl-1">?: </span><span class="hl-2">&#39;standard&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;lean&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;enterprise&#39;</span><span class="hl-1">; </span><span class="hl-3">// Default: &#39;standard&#39;</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">?: </span><span class="hl-9">Logger</span><span class="hl-1">; </span><span class="hl-3">// See [Logger Configuration](#logger-integration)</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:lock-methods" class="tsd-anchor"></a><h4><a href="#md:lock-methods">Lock Methods</a></h4><pre><code class="language-typescript"><span class="hl-3">// Acquire lock</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Release lock</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">released</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Extend lock TTL</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">extended</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">extend</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">, </span><span class="hl-5">newTTL</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Check if locked</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">isLocked</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">isLocked</span><span class="hl-1">(</span><span class="hl-5">key</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Auto-extending lock with routine execution (NEW!)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">using</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-5">signal</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// Your long-running operation here</span><br/><span class="hl-1">  </span><span class="hl-3">// Lock automatically extends at 80% of TTL</span><br/><span class="hl-1">  </span><span class="hl-3">// Check signal.aborted if extension fails</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-2">&#39;operation-result&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Advanced usage with abort signal checking</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">using</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-5">signal</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-5">i</span><span class="hl-1"> = </span><span class="hl-8">0</span><span class="hl-1">; </span><span class="hl-5">i</span><span class="hl-1"> &lt; </span><span class="hl-8">1000</span><span class="hl-1">; </span><span class="hl-5">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">processItem</span><span class="hl-1">(</span><span class="hl-5">i</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// Check for cancellation (e.g., if lock extension fails)</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">signal</span><span class="hl-1">.</span><span class="hl-5">aborted</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Operation cancelled:&#39;</span><span class="hl-1">, </span><span class="hl-5">signal</span><span class="hl-1">.</span><span class="hl-5">error</span><span class="hl-1">?.</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-5">processed:</span><span class="hl-1"> </span><span class="hl-5">i</span><span class="hl-1"> };</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:performance-modes" class="tsd-anchor"></a><h4><a href="#md:performance-modes">Performance Modes</a></h4><p>Choose the optimal performance mode for your use case:</p>
<pre><code class="language-typescript"><span class="hl-3">// Standard mode (default) - Full features with monitoring</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">performance:</span><span class="hl-1"> </span><span class="hl-2">&#39;standard&#39;</span><span class="hl-1">, </span><span class="hl-3">// Full monitoring, health checks</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Lean mode - Memory optimized for high-throughput scenarios</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">leanLock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">performance:</span><span class="hl-1"> </span><span class="hl-2">&#39;lean&#39;</span><span class="hl-1">, </span><span class="hl-3">// Saves ~150KB memory, 3% faster</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p><strong>Performance Mode Comparison:</strong></p>
<ul>
<li><strong>Standard</strong>: Full monitoring, health checks, comprehensive error details</li>
<li><strong>Lean</strong>: Memory-optimized, pre-allocated errors, minimal overhead</li>
<li><strong>Enterprise</strong>: Standard + circuit breakers + advanced observability (future)</li>
</ul>
<a id="md:logger-integration" class="tsd-anchor"></a><h4><a href="#md:logger-integration">Logger Integration</a></h4><p>Configure structured logging for production observability:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">Logger</span><span class="hl-1">, </span><span class="hl-5">LogLevel</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Create logger instance</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logger</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Logger</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">level:</span><span class="hl-1"> </span><span class="hl-5">LogLevel</span><span class="hl-1">.</span><span class="hl-7">INFO</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">prefix:</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">enableConsole:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-3">// Console output</span><br/><span class="hl-1">  </span><span class="hl-5">enableCollection:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-3">// In-memory collection for metrics</span><br/><span class="hl-1">  </span><span class="hl-5">maxEntries:</span><span class="hl-1"> </span><span class="hl-8">1000</span><span class="hl-1">, </span><span class="hl-3">// Limit memory usage</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Use with SimpleLock</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">, </span><span class="hl-3">// Enhanced monitoring and error reporting</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Use with RedLock</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlock</span><span class="hl-1"> = </span><span class="hl-0">createRedlock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapters:</span><span class="hl-1"> [</span><span class="hl-5">adapter1</span><span class="hl-1">, </span><span class="hl-5">adapter2</span><span class="hl-1">, </span><span class="hl-5">adapter3</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;distributed-resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">, </span><span class="hl-3">// Distributed lock state tracking</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p><strong>Logger Configuration:</strong></p>
<pre><code class="language-typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-9">LoggerConfig</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">level</span><span class="hl-1">: </span><span class="hl-9">LogLevel</span><span class="hl-1">; </span><span class="hl-3">// DEBUG, INFO, WARN, ERROR</span><br/><span class="hl-1">  </span><span class="hl-5">prefix</span><span class="hl-1">?: </span><span class="hl-9">string</span><span class="hl-1">; </span><span class="hl-3">// Log prefix for identification</span><br/><span class="hl-1">  </span><span class="hl-5">enableConsole</span><span class="hl-1">?: </span><span class="hl-9">boolean</span><span class="hl-1">; </span><span class="hl-3">// Console output (default: true)</span><br/><span class="hl-1">  </span><span class="hl-5">enableCollection</span><span class="hl-1">?: </span><span class="hl-9">boolean</span><span class="hl-1">; </span><span class="hl-3">// In-memory collection (default: false)</span><br/><span class="hl-1">  </span><span class="hl-5">maxEntries</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Max entries to keep (default: 100)</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p><strong>What Gets Logged:</strong></p>
<ul>
<li>‚úÖ Lock acquisition attempts and failures</li>
<li>‚úÖ Circuit breaker state changes (open/closed/half-open)</li>
<li>‚úÖ Redis connection health checks and recovery</li>
<li>‚úÖ Auto-extension successes and failures</li>
<li>‚úÖ Redis adapter warnings (disconnect issues)</li>
<li>‚úÖ Lock release errors and cleanup issues</li>
</ul>
<p><strong>Accessing Collected Logs:</strong></p>
<pre><code class="language-typescript"><span class="hl-3">// Get recent log entries for analysis</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">entries</span><span class="hl-1"> = </span><span class="hl-5">logger</span><span class="hl-1">.</span><span class="hl-0">getEntries</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Collected </span><span class="hl-6">${</span><span class="hl-5">entries</span><span class="hl-10">.</span><span class="hl-5">length</span><span class="hl-6">}</span><span class="hl-2"> log entries`</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Check for errors in the last hour</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">recentErrors</span><span class="hl-1"> = </span><span class="hl-5">entries</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">entry</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-5">entry</span><span class="hl-1">.</span><span class="hl-5">level</span><span class="hl-1"> === </span><span class="hl-5">LogLevel</span><span class="hl-1">.</span><span class="hl-7">ERROR</span><span class="hl-1"> &amp;&amp; </span><span class="hl-5">entry</span><span class="hl-1">.</span><span class="hl-5">timestamp</span><span class="hl-1"> &gt; </span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-8">3600000</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:distributed-lock-redlock" class="tsd-anchor"></a><h3><a href="#md:distributed-lock-redlock">Distributed Lock (RedLock)</a></h3><a id="md:createredlockconfig" class="tsd-anchor"></a><h4><a href="#md:createredlockconfig"><code>createRedlock(config)</code></a></h4><p>Creates a distributed lock using the Redlock algorithm.</p>
<pre><code class="language-typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-9">CreateRedlockConfig</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">adapters</span><span class="hl-1">: </span><span class="hl-9">RedisAdapter</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-5">key</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">ttl</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 30000ms</span><br/><span class="hl-1">  </span><span class="hl-5">quorum</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: majority</span><br/><span class="hl-1">  </span><span class="hl-5">retryAttempts</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 3</span><br/><span class="hl-1">  </span><span class="hl-5">retryDelay</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 200ms</span><br/><span class="hl-1">  </span><span class="hl-5">clockDriftFactor</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Default: 0.01</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">?: </span><span class="hl-9">Logger</span><span class="hl-1">; </span><span class="hl-3">// See [Logger Configuration](#logger-integration)</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:redis-adapters" class="tsd-anchor"></a><h3><a href="#md:redis-adapters">Redis Adapters</a></h3><a id="md:node-redis-adapter" class="tsd-anchor"></a><h4><a href="#md:node-redis-adapter">Node-Redis Adapter</a></h4><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">NodeRedisAdapter</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">createClient</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redis&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-0">createClient</span><span class="hl-1">({ </span><span class="hl-5">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;redis://localhost:6379&#39;</span><span class="hl-1"> });</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Basic adapter</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adapter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// With logger support (NEW!)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adapter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">keyPrefix:</span><span class="hl-1"> </span><span class="hl-2">&#39;myapp:&#39;</span><span class="hl-1">, </span><span class="hl-3">// Optional key prefix</span><br/><span class="hl-1">  </span><span class="hl-5">timeout:</span><span class="hl-1"> </span><span class="hl-8">5000</span><span class="hl-1">, </span><span class="hl-3">// Redis operation timeout</span><br/><span class="hl-1">  </span><span class="hl-5">logger:</span><span class="hl-1"> </span><span class="hl-5">logger</span><span class="hl-1">, </span><span class="hl-3">// Structured logging for adapter operations</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:ioredis-adapter" class="tsd-anchor"></a><h4><a href="#md:ioredis-adapter">Ioredis Adapter</a></h4><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">IoredisAdapter</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-5">Redis</span><span class="hl-1"> </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ioredis&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Redis</span><span class="hl-1">(</span><span class="hl-2">&#39;redis://localhost:6379&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Basic adapter</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adapter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">IoredisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// With logger support (NEW!)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adapter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">IoredisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">keyPrefix:</span><span class="hl-1"> </span><span class="hl-2">&#39;myapp:&#39;</span><span class="hl-1">, </span><span class="hl-3">// Optional key prefix</span><br/><span class="hl-1">  </span><span class="hl-5">timeout:</span><span class="hl-1"> </span><span class="hl-8">5000</span><span class="hl-1">, </span><span class="hl-3">// Redis operation timeout</span><br/><span class="hl-1">  </span><span class="hl-5">maxRetries:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">, </span><span class="hl-3">// Redis operation retries</span><br/><span class="hl-1">  </span><span class="hl-5">retryDelay:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">, </span><span class="hl-3">// Delay between retries</span><br/><span class="hl-1">  </span><span class="hl-5">logger:</span><span class="hl-1"> </span><span class="hl-5">logger</span><span class="hl-1">, </span><span class="hl-3">// Structured logging for adapter operations</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p><strong>Redis Adapter Options:</strong></p>
<pre><code class="language-typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-9">RedisAdapterOptions</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">keyPrefix</span><span class="hl-1">?: </span><span class="hl-9">string</span><span class="hl-1">; </span><span class="hl-3">// Prefix for all Redis keys</span><br/><span class="hl-1">  </span><span class="hl-5">maxRetries</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Max retries for failed operations (default: 3)</span><br/><span class="hl-1">  </span><span class="hl-5">retryDelay</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Delay between retries in ms (default: 100)</span><br/><span class="hl-1">  </span><span class="hl-5">timeout</span><span class="hl-1">?: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-3">// Operation timeout in ms (default: 5000)</span><br/><span class="hl-1">  </span><span class="hl-5">logger</span><span class="hl-1">?: </span><span class="hl-9">Logger</span><span class="hl-1">; </span><span class="hl-3">// See [Logger Configuration](#logger-integration)</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p><strong>What Adapters Log:</strong></p>
<ul>
<li>‚ö†Ô∏è Redis disconnect warnings (connection cleanup issues)</li>
<li>üîÑ Operation retries and timeouts</li>
<li>üö´ Validation errors (invalid keys, TTL values)</li>
<li>üîó Connection health and status changes</li>
</ul>
<a id="md:factory-functions" class="tsd-anchor"></a><h3><a href="#md:factory-functions">Factory Functions</a></h3><p>Convenient functions for creating multiple locks or specialized configurations:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">createLocks</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">createPrefixedLock</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">createRedlocks</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Create multiple locks with shared configuration</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">locks</span><span class="hl-1"> = </span><span class="hl-0">createLocks</span><span class="hl-1">(</span><span class="hl-5">adapter</span><span class="hl-1">, [</span><span class="hl-2">&#39;user:123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;account:456&#39;</span><span class="hl-1">], {</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">15000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAttempts:</span><span class="hl-1"> </span><span class="hl-8">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">performance:</span><span class="hl-1"> </span><span class="hl-2">&#39;lean&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Create lock with automatic key prefixing</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userLock</span><span class="hl-1"> = </span><span class="hl-0">createPrefixedLock</span><span class="hl-1">(</span><span class="hl-5">adapter</span><span class="hl-1">, </span><span class="hl-2">&#39;locks:user:&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;123&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">10000</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-3">// Results in key: &quot;locks:user:123&quot;</span><br/><br/><span class="hl-3">// Create multiple distributed locks</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlocks</span><span class="hl-1"> = </span><span class="hl-0">createRedlocks</span><span class="hl-1">(</span><br/><span class="hl-1">  [</span><span class="hl-5">adapter1</span><span class="hl-1">, </span><span class="hl-5">adapter2</span><span class="hl-1">, </span><span class="hl-5">adapter3</span><span class="hl-1">],</span><br/><span class="hl-1">  [</span><span class="hl-2">&#39;resource1&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;resource2&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">15000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">quorum:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">retryAttempts:</span><span class="hl-1"> </span><span class="hl-8">5</span><span class="hl-1">,</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:advanced-usage" class="tsd-anchor"></a><h2><a href="#md:advanced-usage">Advanced Usage</a></h2><a id="md:lock-with-retry-logic" class="tsd-anchor"></a><h3><a href="#md:lock-with-retry-logic">Lock with Retry Logic</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">client</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;contested-resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">10000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAttempts:</span><span class="hl-1"> </span><span class="hl-8">5</span><span class="hl-1">, </span><span class="hl-3">// Retry up to 5 times</span><br/><span class="hl-1">  </span><span class="hl-5">retryDelay:</span><span class="hl-1"> </span><span class="hl-8">200</span><span class="hl-1">, </span><span class="hl-3">// Wait 200ms between retries</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:lock-extension" class="tsd-anchor"></a><h3><a href="#md:lock-extension">Lock Extension</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Extend lock by 10 more seconds</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">extended</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">extend</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">, </span><span class="hl-8">10000</span><span class="hl-1">);</span><br/><br/><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">extended</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">// Continue working with extended lock</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">longRunningTask</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:auto-extension-with-using-api" class="tsd-anchor"></a><h3><a href="#md:auto-extension-with-using-api">Auto-Extension with using() API</a></h3><p>The <code>using()</code> method provides automatic lock management with auto-extension for
long-running operations. It handles lock acquisition, automatic extension when
needed, and guaranteed cleanup.</p>
<a id="md:simple-lock-auto-extension" class="tsd-anchor"></a><h4><a href="#md:simple-lock-auto-extension">Simple Lock Auto-Extension</a></h4><pre><code class="language-typescript"><span class="hl-3">// Auto-extending lock with routine execution</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">using</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-5">signal</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// Long-running operation - lock automatically extends at 80% of TTL</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">processLargeDataset</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-3">// Check if extension failed (loss of lock)</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">signal</span><span class="hl-1">.</span><span class="hl-5">aborted</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Lock lost: </span><span class="hl-6">${</span><span class="hl-5">signal</span><span class="hl-10">.</span><span class="hl-5">error</span><span class="hl-10">?.</span><span class="hl-5">message</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-2">&#39;processing-complete&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">result</span><span class="hl-1">); </span><span class="hl-3">// &#39;processing-complete&#39;</span>
</code><button>Copy</button></pre>
<a id="md:distributed-lock-auto-extension" class="tsd-anchor"></a><h4><a href="#md:distributed-lock-auto-extension">Distributed Lock Auto-Extension</a></h4><pre><code class="language-typescript"><span class="hl-3">// Distributed lock with quorum-based auto-extension</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlock</span><span class="hl-1"> = </span><span class="hl-0">createRedlock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapters:</span><span class="hl-1"> [</span><span class="hl-5">adapter1</span><span class="hl-1">, </span><span class="hl-5">adapter2</span><span class="hl-1">, </span><span class="hl-5">adapter3</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;distributed-job&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">quorum:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">using</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-5">signal</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">item</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-5">largeJobQueue</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">// Process each item - lock extends automatically</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">processItem</span><span class="hl-1">(</span><span class="hl-5">item</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// Abort if quorum lost (majority of Redis nodes failed)</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">signal</span><span class="hl-1">.</span><span class="hl-5">aborted</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">`Distributed lock lost: </span><span class="hl-6">${</span><span class="hl-5">signal</span><span class="hl-10">.</span><span class="hl-5">error</span><span class="hl-10">?.</span><span class="hl-5">message</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-2">&#39;all-items-processed&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:real-world-examples" class="tsd-anchor"></a><h4><a href="#md:real-world-examples">Real-World Examples</a></h4><p>For implementation patterns including database transactions, cache warming, and
job processing, see the <a href="./examples/">examples directory</a>.</p>
<a id="md:error-handling" class="tsd-anchor"></a><h3><a href="#md:error-handling">Error Handling</a></h3><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">LockAcquisitionError</span><span class="hl-1">, </span><span class="hl-5">LockReleaseError</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">// ... work ...</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-4">catch</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1"> </span><span class="hl-6">instanceof</span><span class="hl-1"> </span><span class="hl-9">LockAcquisitionError</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Failed to acquire lock:&#39;</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-4">else</span><span class="hl-1"> </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1"> </span><span class="hl-6">instanceof</span><span class="hl-1"> </span><span class="hl-9">LockReleaseError</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Failed to release lock:&#39;</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:multiple-resource-locking" class="tsd-anchor"></a><h3><a href="#md:multiple-resource-locking">Multiple Resource Locking</a></h3><pre><code class="language-typescript"><span class="hl-3">// Lock multiple resources in consistent order (avoid deadlocks)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userLock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({ </span><span class="hl-5">adapter</span><span class="hl-1">, </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;user:123&#39;</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">accountLock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({ </span><span class="hl-5">adapter</span><span class="hl-1">, </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;account:456&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userHandle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">userLock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">accountHandle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">accountLock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><br/><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// Perform transaction requiring both resources</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">transferFunds</span><span class="hl-1">();</span><br/><span class="hl-1">} </span><span class="hl-4">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// Release in reverse order</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">accountLock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">accountHandle</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">userLock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">userHandle</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:best-practices" class="tsd-anchor"></a><h2><a href="#md:best-practices">Best Practices</a></h2><a id="md:1-always-use-try-finally-for-lock-release" class="tsd-anchor"></a><h3><a href="#md:1-always-use-try-finally-for-lock-release">1. Always Use Try-Finally for Lock Release</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">doWork</span><span class="hl-1">();</span><br/><span class="hl-1">} </span><span class="hl-4">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:2-choose-appropriate-ttl" class="tsd-anchor"></a><h3><a href="#md:2-choose-appropriate-ttl">2. Choose Appropriate TTL</a></h3><pre><code class="language-typescript"><span class="hl-3">// Short-lived operations</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({ </span><span class="hl-5">adapter</span><span class="hl-1">, </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;quick-task&#39;</span><span class="hl-1">, </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">5000</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Long-running operations</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({ </span><span class="hl-5">adapter</span><span class="hl-1">, </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;batch-job&#39;</span><span class="hl-1">, </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">300000</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:3-handle-lock-contention" class="tsd-anchor"></a><h3><a href="#md:3-handle-lock-contention">3. Handle Lock Contention</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;popular-resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAttempts:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryDelay:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">// ... work ...</span><br/><span class="hl-1">} </span><span class="hl-4">catch</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1"> </span><span class="hl-6">instanceof</span><span class="hl-1"> </span><span class="hl-9">LockAcquisitionError</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">// Resource is busy, handle gracefully</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">scheduleForLater</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:4-distributed-lock-quorum" class="tsd-anchor"></a><h3><a href="#md:4-distributed-lock-quorum">4. Distributed Lock Quorum</a></h3><pre><code class="language-typescript"><span class="hl-3">// For 5 Redis instances, use quorum of 3</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlock</span><span class="hl-1"> = </span><span class="hl-0">createRedlock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapters:</span><span class="hl-1"> [</span><span class="hl-5">redis1</span><span class="hl-1">, </span><span class="hl-5">redis2</span><span class="hl-1">, </span><span class="hl-5">redis3</span><span class="hl-1">, </span><span class="hl-5">redis4</span><span class="hl-1">, </span><span class="hl-5">redis5</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">quorum:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">, </span><span class="hl-3">// Majority consensus</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;critical-resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:monitoring-and-observability" class="tsd-anchor"></a><h2><a href="#md:monitoring-and-observability">Monitoring and Observability</a></h2><a id="md:lock-metadata" class="tsd-anchor"></a><h3><a href="#md:lock-metadata">Lock Metadata</a></h3><pre><code class="language-typescript"><span class="hl-3">// Access lock metadata</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Lock acquired in:&#39;</span><span class="hl-1">, </span><span class="hl-5">handle</span><span class="hl-1">.</span><span class="hl-5">metadata</span><span class="hl-1">.</span><span class="hl-5">acquisitionTime</span><span class="hl-1">, </span><span class="hl-2">&#39;ms&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Attempts required:&#39;</span><span class="hl-1">, </span><span class="hl-5">handle</span><span class="hl-1">.</span><span class="hl-5">metadata</span><span class="hl-1">.</span><span class="hl-5">attempts</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// For distributed locks</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlockHandle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Nodes locked:&#39;</span><span class="hl-1">, </span><span class="hl-5">redlockHandle</span><span class="hl-1">.</span><span class="hl-5">metadata</span><span class="hl-1">.</span><span class="hl-5">nodes</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Quorum achieved:&#39;</span><span class="hl-1">, </span><span class="hl-5">redlockHandle</span><span class="hl-1">.</span><span class="hl-5">metadata</span><span class="hl-1">.</span><span class="hl-5">nodes</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1"> &gt;= </span><span class="hl-5">quorum</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:structured-logging-new" class="tsd-anchor"></a><h3><a href="#md:structured-logging-new">Structured Logging (NEW!)</a></h3><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">Logger</span><span class="hl-1">, </span><span class="hl-5">LogLevel</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock-universal&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Production logging setup</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logger</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Logger</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">level:</span><span class="hl-1"> </span><span class="hl-5">LogLevel</span><span class="hl-1">.</span><span class="hl-7">INFO</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">prefix:</span><span class="hl-1"> </span><span class="hl-2">&#39;redlock&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">enableConsole:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-3">// For development</span><br/><span class="hl-1">  </span><span class="hl-5">enableCollection:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-3">// For metrics collection</span><br/><span class="hl-1">  </span><span class="hl-5">maxEntries:</span><span class="hl-1"> </span><span class="hl-8">1000</span><span class="hl-1">, </span><span class="hl-3">// Memory limit</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Configure locks with logger</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({ </span><span class="hl-5">adapter</span><span class="hl-1">, </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">, </span><span class="hl-5">logger</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Monitor lock operations</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">entries</span><span class="hl-1"> = </span><span class="hl-5">logger</span><span class="hl-1">.</span><span class="hl-0">getEntries</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">errors</span><span class="hl-1"> = </span><span class="hl-5">entries</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-5">e</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">e</span><span class="hl-1">.</span><span class="hl-5">level</span><span class="hl-1"> === </span><span class="hl-5">LogLevel</span><span class="hl-1">.</span><span class="hl-7">ERROR</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">warnings</span><span class="hl-1"> = </span><span class="hl-5">entries</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-5">e</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">e</span><span class="hl-1">.</span><span class="hl-5">level</span><span class="hl-1"> === </span><span class="hl-5">LogLevel</span><span class="hl-1">.</span><span class="hl-7">WARN</span><span class="hl-1">);</span><br/><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Lock errors: </span><span class="hl-6">${</span><span class="hl-5">errors</span><span class="hl-10">.</span><span class="hl-5">length</span><span class="hl-6">}</span><span class="hl-2">, Warnings: </span><span class="hl-6">${</span><span class="hl-5">warnings</span><span class="hl-10">.</span><span class="hl-5">length</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:architecture-improvements" class="tsd-anchor"></a><h3><a href="#md:architecture-improvements">Architecture Improvements</a></h3><ul>
<li>‚úÖ <strong>Race condition protection</strong>: Atomic extension scripts eliminate timing
race conditions in auto-extension</li>
<li>‚úÖ <strong>Consistent logging</strong>: All components use structured Logger instead of
mixed console.* calls</li>
<li>‚úÖ <strong>Zero NODE_ENV checks</strong>: Production code no longer depends on environment
variables for behavior</li>
<li>‚úÖ <strong>Configurable observability</strong>: Enable/disable console output and metrics
collection independently</li>
<li>‚úÖ <strong>Enhanced context</strong>: All log entries include relevant context (keys,
correlation IDs, timestamps)</li>
<li>‚úÖ <strong>Memory management</strong>: Built-in log rotation with configurable limits</li>
<li>‚úÖ <strong>TTL feedback</strong>: Atomic operations provide real-time TTL information for
intelligent scheduling</li>
</ul>
<a id="md:performance" class="tsd-anchor"></a><h2><a href="#md:performance">Performance</a></h2><p>redlock-universal delivers competitive performance:</p>
<ul>
<li><strong>Lock acquisition</strong>: Sub-millisecond latency (typically 0.4-0.8ms with local
Redis)</li>
<li><strong>Memory usage</strong>: &lt;7KB per operation (both standard and lean modes)</li>
<li><strong>Throughput</strong>: &gt;1000 ops/sec (competitive with leading Redis lock libraries)</li>
<li><strong>Test coverage</strong>: 85%+ with unit and integration tests</li>
</ul>
<p>Performance modes:</p>
<ul>
<li><strong>Standard</strong> (default): Full monitoring and observability features</li>
<li><strong>Lean</strong>: Memory-optimized with minimal overhead for maximum speed</li>
<li><strong>Enterprise</strong>: Additional health checks and circuit breakers</li>
</ul>
<a id="md:benchmarking" class="tsd-anchor"></a><h3><a href="#md:benchmarking">Benchmarking</a></h3><p>We provide benchmarks to validate performance claims:</p>
<pre><code class="language-bash"><span class="hl-3"># Compare with leading Redis lock libraries</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">benchmark:competitive</span><br/><br/><span class="hl-3"># Internal performance validation</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">benchmark:performance</span><br/><br/><span class="hl-3"># Run all benchmarks</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">benchmark</span>
</code><button>Copy</button></pre>
<p><strong>Benchmark Philosophy</strong>: We believe in honest, reproducible performance
testing. Our benchmarks:</p>
<ul>
<li>Test against real Redis instances (not mocks)</li>
<li>Include statistical analysis (mean, p50, p95, p99)</li>
<li>Acknowledge performance variability between runs</li>
<li>Focus on competitive positioning rather than absolute claims</li>
</ul>
<a id="md:comparison-with-alternatives" class="tsd-anchor"></a><h2><a href="#md:comparison-with-alternatives">Comparison with Alternatives</a></h2><blockquote>
<p><strong>Methodology</strong>: This comparison uses data from npm registry (July 2025) and
architectural analysis. Performance estimates are based on implementation
patterns and Redis operation complexity.</p>
</blockquote>
<a id="md:feature-comparison" class="tsd-anchor"></a><h3><a href="#md:feature-comparison">Feature Comparison</a></h3><table>
<thead>
<tr>
<th>Feature</th>
<th>redlock-universal</th>
<th>node-redlock</th>
<th>redis-semaphore</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Client Support</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>node-redis v4+</td>
<td>‚úÖ Native</td>
<td>‚ùå</td>
<td>‚ö†Ô∏è Wrapper needed</td>
</tr>
<tr>
<td>ioredis v5+</td>
<td>‚úÖ Native</td>
<td>‚úÖ Required</td>
<td>‚úÖ Native</td>
</tr>
<tr>
<td><strong>Language &amp; Developer Experience</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>TypeScript</td>
<td>‚úÖ First-class</td>
<td>‚úÖ Native</td>
<td>‚úÖ Native</td>
</tr>
<tr>
<td>Modern ESM</td>
<td>‚úÖ</td>
<td>‚ö†Ô∏è CJS focus</td>
<td>‚úÖ</td>
</tr>
<tr>
<td>API Design</td>
<td>‚úÖ Intuitive</td>
<td>‚ö†Ô∏è Complex</td>
<td>‚úÖ Clean</td>
</tr>
<tr>
<td>Error Types</td>
<td>‚úÖ Specific</td>
<td>‚úÖ Basic</td>
<td>‚úÖ Detailed</td>
</tr>
<tr>
<td><strong>Locking Capabilities</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Single Instance</td>
<td>‚úÖ Optimized</td>
<td>‚ùå</td>
<td>‚úÖ</td>
</tr>
<tr>
<td>Distributed (Redlock)</td>
<td>‚úÖ Full spec</td>
<td>‚úÖ Full spec</td>
<td>‚úÖ RedlockMutex</td>
</tr>
<tr>
<td>Lock Extension</td>
<td>‚úÖ Manual/Auto</td>
<td>‚úÖ Watchdog</td>
<td>‚úÖ Auto-refresh</td>
</tr>
<tr>
<td>Semaphores</td>
<td>‚ùå Planned</td>
<td>‚ùå</td>
<td>‚úÖ Advanced</td>
</tr>
<tr>
<td><strong>Production Features</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Retry Logic</td>
<td>‚úÖ Configurable</td>
<td>‚úÖ Built-in</td>
<td>‚úÖ Fair queue</td>
</tr>
<tr>
<td>Monitoring</td>
<td>‚úÖ Built-in</td>
<td>‚ùå</td>
<td>‚ùå</td>
</tr>
<tr>
<td>Health Checks</td>
<td>‚úÖ Built-in</td>
<td>‚ùå</td>
<td>‚ùå</td>
</tr>
<tr>
<td>Structured Logging</td>
<td>‚úÖ Built-in</td>
<td>‚ùå</td>
<td>‚ùå</td>
</tr>
</tbody></table>
<a id="md:technical-comparison-verified-data" class="tsd-anchor"></a><h3><a href="#md:technical-comparison-verified-data">Technical Comparison (Verified Data)</a></h3><table>
<thead>
<tr>
<th>Metric</th>
<th>redlock-universal</th>
<th>node-redlock</th>
<th>redis-semaphore</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Maintenance &amp; Adoption</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Weekly Downloads</td>
<td><em>New Package</em></td>
<td>644,599</td>
<td>282,020</td>
</tr>
<tr>
<td>Last Updated</td>
<td>2025 Active</td>
<td>Mar 2022 ‚ö†Ô∏è</td>
<td>Mar 2025 ‚úÖ</td>
</tr>
<tr>
<td>Maintenance Status</td>
<td>‚úÖ Active</td>
<td>‚ö†Ô∏è Stale (3y)</td>
<td>‚úÖ Active</td>
</tr>
<tr>
<td><strong>Package Quality</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Runtime Dependencies</td>
<td>0 (peer only)</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>TypeScript Support</td>
<td>‚úÖ Native</td>
<td>‚úÖ Native</td>
<td>‚úÖ Native</td>
</tr>
<tr>
<td>Test Coverage</td>
<td>85%+ Unit + Integration</td>
<td>Unknown</td>
<td>Unknown</td>
</tr>
<tr>
<td><strong>Performance Characteristics</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Lock Acquisition‚Ä†</td>
<td>~0.4-0.8ms</td>
<td>~0.4-0.8ms</td>
<td>~0.4-0.6ms</td>
</tr>
<tr>
<td>Distributed Latency*</td>
<td>~3-8ms</td>
<td>~5-15ms</td>
<td>~4-10ms</td>
</tr>
<tr>
<td>Memory per Operation‚Ä†</td>
<td>&lt;7KB</td>
<td>~8KB</td>
<td>~6KB</td>
</tr>
</tbody></table>
<p><em>*Estimated/measured with local Redis 7. Performance is competitive among
actively maintained libraries. ‚Ä†Actual performance varies by network latency and
Redis configuration.</em></p>
<a id="md:maintenance-analysis" class="tsd-anchor"></a><h3><a href="#md:maintenance-analysis">Maintenance Analysis</a></h3><table>
<thead>
<tr>
<th>Package</th>
<th>Status</th>
<th>Assessment</th>
</tr>
</thead>
<tbody><tr>
<td><strong>node-redlock</strong></td>
<td>Last updated March 2022</td>
<td>Consider compatibility with newer Redis versions</td>
</tr>
<tr>
<td><strong>redis-semaphore</strong></td>
<td>Actively maintained</td>
<td>Good feature set, reliable choice</td>
</tr>
</tbody></table>
<a id="md:why-choose-redlock-universal" class="tsd-anchor"></a><h3><a href="#md:why-choose-redlock-universal">Why Choose redlock-universal?</a></h3><a id="md:‚úÖ-universal-compatibility" class="tsd-anchor"></a><h4><a href="#md:‚úÖ-universal-compatibility">‚úÖ <strong>Universal Compatibility</strong></a></h4><ul>
<li><strong>Only library</strong> supporting both node-redis v4+ and ioredis v5+ natively</li>
<li><strong>Future-proof</strong>: Works with latest Redis client versions</li>
<li><strong>Migration-friendly</strong>: Easy to switch between Redis clients</li>
</ul>
<a id="md:‚úÖ-production-ready-observability" class="tsd-anchor"></a><h4><a href="#md:‚úÖ-production-ready-observability">‚úÖ <strong>Production-Ready Observability</strong></a></h4><ul>
<li><strong>Built-in metrics</strong>: Track lock performance, acquisition times, success rates</li>
<li><strong>Health monitoring</strong>: Redis connection health checks and statistics</li>
<li><strong>Structured logging</strong>: Configurable logging with context and levels</li>
<li><strong>Zero competitors</strong> offer these enterprise features</li>
</ul>
<a id="md:‚úÖ-modern-architecture-amp-dx" class="tsd-anchor"></a><h4><a href="#md:‚úÖ-modern-architecture-amp-dx">‚úÖ <strong>Modern Architecture &amp; DX</strong></a></h4><ul>
<li><strong>TypeScript-first</strong>: Strict typing, excellent IntelliSense</li>
<li><strong>ESM native</strong>: Modern module system with CommonJS compatibility</li>
<li><strong>Zero runtime dependencies</strong>: Security and supply chain safety</li>
<li><strong>Code quality</strong>: 85%+ test coverage with unit and integration tests</li>
</ul>
<a id="md:‚úÖ-proven-algorithm-implementation" class="tsd-anchor"></a><h4><a href="#md:‚úÖ-proven-algorithm-implementation">‚úÖ <strong>Proven Algorithm Implementation</strong></a></h4><ul>
<li><strong>Redis-spec compliant</strong>: Follows official Redlock specification</li>
<li><strong>Clock drift handling</strong>: Proper time synchronization assumptions</li>
<li><strong>Fault tolerance</strong>: Graceful degradation on partial failures</li>
<li><strong>Performance optimized</strong>: Sub-millisecond acquisition, competitive
performance</li>
</ul>
<a id="md:migration-guide" class="tsd-anchor"></a><h3><a href="#md:migration-guide">Migration Guide</a></h3><a id="md:from-node-redlock" class="tsd-anchor"></a><h4><a href="#md:from-node-redlock">From node-redlock</a></h4><pre><code class="language-typescript"><span class="hl-3">// Before (node-redlock) - Stale for 3 years</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlock</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Redlock</span><span class="hl-1">([</span><span class="hl-5">redis1</span><span class="hl-1">, </span><span class="hl-5">redis2</span><span class="hl-1">], { </span><span class="hl-5">retryCount:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">resource</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">([</span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">], </span><span class="hl-8">30000</span><span class="hl-1">);</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">resource</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// After (redlock-universal) - Modern &amp; maintained</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redlock</span><span class="hl-1"> = </span><span class="hl-0">createRedlock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapters:</span><span class="hl-1"> [</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">IoredisAdapter</span><span class="hl-1">(</span><span class="hl-5">redis1</span><span class="hl-1">), </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">IoredisAdapter</span><span class="hl-1">(</span><span class="hl-5">redis2</span><span class="hl-1">)],</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAttempts:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">redlock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:from-redis-semaphore" class="tsd-anchor"></a><h4><a href="#md:from-redis-semaphore">From redis-semaphore</a></h4><pre><code class="language-typescript"><span class="hl-3">// Before (redis-semaphore) - Good but limited to ioredis</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">mutex</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Mutex</span><span class="hl-1">(</span><span class="hl-5">redis</span><span class="hl-1">, </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">, { </span><span class="hl-5">acquireTimeout:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">release</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">mutex</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-0">release</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// After (redlock-universal) - Universal client support + monitoring</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">lock</span><span class="hl-1"> = </span><span class="hl-0">createLock</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">adapter:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">NodeRedisAdapter</span><span class="hl-1">(</span><span class="hl-5">nodeRedisClient</span><span class="hl-1">), </span><span class="hl-3">// or IoredisAdapter</span><br/><span class="hl-1">  </span><span class="hl-5">key:</span><span class="hl-1"> </span><span class="hl-2">&#39;resource&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">ttl:</span><span class="hl-1"> </span><span class="hl-8">30000</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">lock</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(</span><span class="hl-5">handle</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:testing" class="tsd-anchor"></a><h2><a href="#md:testing">Testing</a></h2><pre><code class="language-bash"><span class="hl-3"># Run unit tests</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">test</span><br/><br/><span class="hl-3"># Run integration tests (requires Redis)</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">test:integration</span><br/><br/><span class="hl-3"># Run all tests with coverage</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">test:coverage</span><br/><br/><span class="hl-3"># Run Docker-based tests</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">test:docker</span>
</code><button>Copy</button></pre>
<a id="md:faq" class="tsd-anchor"></a><h2><a href="#md:faq">FAQ</a></h2><p><strong>Q: What&#39;s the performance overhead of auto-extension?</strong>
A: Minimal - typically &lt;1ms using atomic operations.</p>
<p><strong>Q: How does this handle Redis restarts?</strong>
A: Lua scripts auto-reload on NOSCRIPT errors, no action needed.</p>
<p><strong>Q: SimpleLock vs RedLock?</strong>
A: SimpleLock = single Redis (faster). RedLock = multiple Redis (fault-tolerant).</p>
<a id="md:troubleshooting" class="tsd-anchor"></a><h2><a href="#md:troubleshooting">Troubleshooting</a></h2><a id="md:common-issues" class="tsd-anchor"></a><h3><a href="#md:common-issues">Common Issues</a></h3><p><strong>Lock not releasing:</strong></p>
<ul>
<li>Ensure the lock handle matches the stored value</li>
<li>Check if TTL expired before release attempt</li>
<li>Verify Redis connectivity</li>
</ul>
<p><strong>Auto-extension not working:</strong></p>
<ul>
<li>Verify ATOMIC_EXTENSION_SAFETY_BUFFER is defined (2000ms default)</li>
<li>Check that TTL is long enough for your operation</li>
<li>Monitor the AbortSignal for extension failures</li>
</ul>
<p><strong>Circuit breaker opening frequently:</strong></p>
<ul>
<li>Increase timeout values</li>
<li>Check Redis server performance</li>
<li>Review network latency</li>
</ul>
<p><strong>&quot;NOSCRIPT&quot; errors:</strong></p>
<ul>
<li>Redis flushed Lua script cache</li>
<li>Library automatically reloads scripts</li>
<li>No action needed, but indicates Redis restart</li>
</ul>
<p><strong>Connection timeouts:</strong></p>
<ul>
<li>Check Redis maxclients setting</li>
<li>Review connection pool configuration</li>
<li>Monitor network latency between app and Redis</li>
</ul>
<a id="md:examples" class="tsd-anchor"></a><h2><a href="#md:examples">Examples</a></h2><p>Quick examples are shown above. For detailed implementations:</p>
<p><strong>Real-World Patterns:</strong></p>
<ul>
<li><a href="./examples/database-transactions.ts">Database Transactions</a> - Transaction safety patterns</li>
<li><a href="./examples/cache-warming.ts">Distributed Cache Warming</a> - Distributed cache coordination  </li>
<li><a href="./examples/job-processing.ts">Job Processing with Progress</a> - Long-running job management</li>
</ul>
<p><strong>Core Usage:</strong></p>
<ul>
<li><a href="./examples/simple-lock-usage.ts">Simple Lock Usage</a> - Basic locking patterns</li>
<li><a href="./examples/redlock-usage.ts">Distributed Lock (RedLock)</a> - Multi-instance coordination</li>
<li><a href="./examples/lock-extension.ts">Lock Extension Patterns</a> - Manual extension strategies</li>
<li><a href="./examples/lock-with-retry.ts">Retry Strategies</a> - Contention handling</li>
<li><a href="./examples/monitoring.ts">Monitoring &amp; Observability</a> - Production monitoring</li>
<li><a href="./examples/adapter-usage.ts">Adapter Usage</a> - Redis client integration</li>
</ul>
<a id="md:contributing" class="tsd-anchor"></a><h2><a href="#md:contributing">Contributing</a></h2><p>We welcome contributions! Please see our <a href="./CONTRIBUTING.md">Contributing Guide</a>
for details.</p>
<ol>
<li>Fork the repository</li>
<li>Create your feature branch (<code>git checkout -b feature/amazing-feature</code>)</li>
<li>Commit your changes (<code>git commit -m &#39;Add amazing feature&#39;</code>)</li>
<li>Push to the branch (<code>git push origin feature/amazing-feature</code>)</li>
<li>Open a Pull Request</li>
</ol>
<a id="md:license" class="tsd-anchor"></a><h2><a href="#md:license">License</a></h2><p><a href="./LICENSE">MIT</a> ¬© Alex Potapenko</p>
<a id="md:support" class="tsd-anchor"></a><h2><a href="#md:support">Support</a></h2><ul>
<li>üìñ <a href="./docs">Documentation</a></li>
<li>üêõ <a href="https://github.com/alexpota/redlock-universal/issues">Issue Tracker</a></li>
<li>üí¨ <a href="https://github.com/alexpota/redlock-universal/discussions">Discussions</a></li>
</ul>
<hr>
<p>Made with ‚ù§Ô∏è for the Node.js community</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:redlock-universal"><span>redlock-<wbr/>universal</span></a><ul><li><a href="#md:overview"><span>Overview</span></a></li><li><a href="#md:features"><span>Features</span></a></li><li><a href="#md:table-of-contents"><span>Table of <wbr/>Contents</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:quick-start"><span>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#md:automatic-lock-management---the-easy-way"><span>Automatic <wbr/>Lock <wbr/>Management -<wbr/> <wbr/>The <wbr/>Easy <wbr/>Way</span></a></li><li><a href="#md:traditional-approach-fine-control"><span>Traditional <wbr/>Approach (<wbr/>Fine <wbr/>Control)</span></a></li><li><a href="#md:distributed-lock-multiple-redis-instances"><span>Distributed <wbr/>Lock (<wbr/>Multiple <wbr/>Redis <wbr/>Instances)</span></a></li></ul></li><li><a href="#md:core-concepts"><span>Core <wbr/>Concepts</span></a></li><li><ul><li><a href="#md:configuration-constants"><span>Configuration <wbr/>Constants</span></a></li></ul></li><li><a href="#md:api-reference"><span>API <wbr/>Reference</span></a></li><li><ul><li><a href="#md:simple-lock"><span>Simple <wbr/>Lock</span></a></li><li><ul><li><a href="#md:createlockconfig"><span>create<wbr/>Lock(config)</span></a></li><li><a href="#md:lock-methods"><span>Lock <wbr/>Methods</span></a></li><li><a href="#md:performance-modes"><span>Performance <wbr/>Modes</span></a></li><li><a href="#md:logger-integration"><span>Logger <wbr/>Integration</span></a></li></ul></li><li><a href="#md:distributed-lock-redlock"><span>Distributed <wbr/>Lock (<wbr/>Red<wbr/>Lock)</span></a></li><li><ul><li><a href="#md:createredlockconfig"><span>create<wbr/>Redlock(config)</span></a></li></ul></li><li><a href="#md:redis-adapters"><span>Redis <wbr/>Adapters</span></a></li><li><ul><li><a href="#md:node-redis-adapter"><span>Node-<wbr/>Redis <wbr/>Adapter</span></a></li><li><a href="#md:ioredis-adapter"><span>Ioredis <wbr/>Adapter</span></a></li></ul></li><li><a href="#md:factory-functions"><span>Factory <wbr/>Functions</span></a></li></ul></li><li><a href="#md:advanced-usage"><span>Advanced <wbr/>Usage</span></a></li><li><ul><li><a href="#md:lock-with-retry-logic"><span>Lock with <wbr/>Retry <wbr/>Logic</span></a></li><li><a href="#md:lock-extension"><span>Lock <wbr/>Extension</span></a></li><li><a href="#md:auto-extension-with-using-api"><span>Auto-<wbr/>Extension with using() API</span></a></li><li><ul><li><a href="#md:simple-lock-auto-extension"><span>Simple <wbr/>Lock <wbr/>Auto-<wbr/>Extension</span></a></li><li><a href="#md:distributed-lock-auto-extension"><span>Distributed <wbr/>Lock <wbr/>Auto-<wbr/>Extension</span></a></li><li><a href="#md:real-world-examples"><span>Real-<wbr/>World <wbr/>Examples</span></a></li></ul></li><li><a href="#md:error-handling"><span>Error <wbr/>Handling</span></a></li><li><a href="#md:multiple-resource-locking"><span>Multiple <wbr/>Resource <wbr/>Locking</span></a></li></ul></li><li><a href="#md:best-practices"><span>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#md:1-always-use-try-finally-for-lock-release"><span>1. <wbr/>Always <wbr/>Use <wbr/>Try-<wbr/>Finally for <wbr/>Lock <wbr/>Release</span></a></li><li><a href="#md:2-choose-appropriate-ttl"><span>2. <wbr/>Choose <wbr/>Appropriate TTL</span></a></li><li><a href="#md:3-handle-lock-contention"><span>3. <wbr/>Handle <wbr/>Lock <wbr/>Contention</span></a></li><li><a href="#md:4-distributed-lock-quorum"><span>4. <wbr/>Distributed <wbr/>Lock <wbr/>Quorum</span></a></li></ul></li><li><a href="#md:monitoring-and-observability"><span>Monitoring and <wbr/>Observability</span></a></li><li><ul><li><a href="#md:lock-metadata"><span>Lock <wbr/>Metadata</span></a></li><li><a href="#md:structured-logging-new"><span>Structured <wbr/>Logging (NEW!)</span></a></li><li><a href="#md:architecture-improvements"><span>Architecture <wbr/>Improvements</span></a></li></ul></li><li><a href="#md:performance"><span>Performance</span></a></li><li><ul><li><a href="#md:benchmarking"><span>Benchmarking</span></a></li></ul></li><li><a href="#md:comparison-with-alternatives"><span>Comparison with <wbr/>Alternatives</span></a></li><li><ul><li><a href="#md:feature-comparison"><span>Feature <wbr/>Comparison</span></a></li><li><a href="#md:technical-comparison-verified-data"><span>Technical <wbr/>Comparison (<wbr/>Verified <wbr/>Data)</span></a></li><li><a href="#md:maintenance-analysis"><span>Maintenance <wbr/>Analysis</span></a></li><li><a href="#md:why-choose-redlock-universal"><span>Why <wbr/>Choose redlock-<wbr/>universal?</span></a></li><li><ul><li><a href="#md:‚úÖ-universal-compatibility"><span>‚úÖ <wbr/>Universal <wbr/>Compatibility</span></a></li><li><a href="#md:‚úÖ-production-ready-observability"><span>‚úÖ <wbr/>Production-<wbr/>Ready <wbr/>Observability</span></a></li><li><a href="#md:‚úÖ-modern-architecture-amp-dx"><span>‚úÖ <wbr/>Modern <wbr/>Architecture &amp; DX</span></a></li><li><a href="#md:‚úÖ-proven-algorithm-implementation"><span>‚úÖ <wbr/>Proven <wbr/>Algorithm <wbr/>Implementation</span></a></li></ul></li><li><a href="#md:migration-guide"><span>Migration <wbr/>Guide</span></a></li><li><ul><li><a href="#md:from-node-redlock"><span>From node-<wbr/>redlock</span></a></li><li><a href="#md:from-redis-semaphore"><span>From redis-<wbr/>semaphore</span></a></li></ul></li></ul></li><li><a href="#md:testing"><span>Testing</span></a></li><li><a href="#md:faq"><span>FAQ</span></a></li><li><a href="#md:troubleshooting"><span>Troubleshooting</span></a></li><li><ul><li><a href="#md:common-issues"><span>Common <wbr/>Issues</span></a></li></ul></li><li><a href="#md:examples"><span>Examples</span></a></li><li><a href="#md:contributing"><span>Contributing</span></a></li><li><a href="#md:license"><span>License</span></a></li><li><a href="#md:support"><span>Support</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>redlock-universal</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>